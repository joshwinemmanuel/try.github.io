<!DOCTYPE html>
<html>

<head>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
</head>

<body>
    <div style="margin-top: 20px; text-align: center;">
        <button id="bu" style="padding: 10px 5px">Show Notification</button>

        <h1>No Flood <br>Detected <br> You are Safe </h1>
    </div>

    <script src="script.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCUy6bWcf0dfmQDEIka-LCUnNyFWQFpzjs",
            authDomain: "water-lvl.firebaseapp.com",
            databaseURL: "https://water-lvl-default-rtdb.firebaseio.com",
            projectId: "water-lvl",
            storageBucket: "water-lvl.appspot.com",
            messagingSenderId: "471168491805",
            appId: "1:471168491805:web:1785c100b063bd471641f4",
            measurementId: "G-4R0JWZS0BZ"
        };

        console.log("Hello world!");

        var i = 0;

        // Initialize Firebase

        firebase.initializeApp(firebaseConfig);


        setInterval(counter, 1000);

        function counter() {

            var firebaseRef = firebase.database().ref().child('test');
            console.log(firebaseRef);
            firebaseRef.once("value").then(function (snapshot) {
                var state = snapshot.val();
                console.log(state.int);

                if (state.int === 2) {

                    console.log(state.int);
                    // document.getElementById("absolute").style.display = "block";
                    // document.getElementById("myaudio").play(); 

                    if (i < 3) {
                        console.log("notifi");
                        console.log(i);
navigator.serviceWorker.register('sw.js');
                        if (!window.Notification) return;

                        Notification
                            .requestPermission()
                            navigator.serviceWorker.ready.then(showNotification)


                        function showNotification(permission) {
                            if (permission !== 'granted') return;
                            let notification = new Notification('Flood Detected', {
                                body: "Please move to a safer location",
                                //icon:'icon.png'        
                            })
                            
                            // notification.onclick = () => {
                            //     // window.open('https://google.com')
                            //     //window.location.href= "https://www.google.com"
                            // }


                        }
                    }

                    i = i+1;
                }
                else {
                    i = 0;
                    console.log("stopnotifi");
                    console.log(i);
                }
            });
        };





    </script>



    </script>
</body>

<!-- let button = document.querySelector('button');
button.addEventListener('click', () => {
    if(!window.Notification) return;
   
    Notification
    .requestPermission()
    .then(showNotification)
});
function showNotification(permission){
    if(permission !== 'granted') return;
    let notification = new Notification('My Title', {
        body:"Hi, how are you today?",
        icon:'icon.png'        
    })
    notification.onclick = () => {
        // window.open('https://google.com')
        window.location.href= "https://www.google.com"
    }
} -->



</html>
